<!doctype html>
<html lang=ko>
<head>
  <meta charset=utf-8>
  <meta name=viewport content="width=device-width, initial-scale=1">
  <title>Verio - AI ê¸°ë°˜ ëŒ€í™” ë¶„ì„ìœ¼ë¡œ ë¡œë§¨ìŠ¤ ìŠ¤ìº  ìœ„í—˜ íƒì§€</title>
  <meta name="color-scheme" content="dark light">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <style>
    :root{ --bg:#0b1020; --bg-card:#121a33; --fg:#e6edf3; --muted:#9fb0d0; --brand:#6aa6ff; --ok:#18a058; --warn:#c29b00; --danger:#c71f1f; --outline:#223055; }
    [data-theme="light"]{ --bg:#f5f7fa; --bg-card:#ffffff; --fg:#1a202c; --muted:#64748b; --brand:#3b82f6; --ok:#059669; --warn:#d97706; --danger:#dc2626; --outline:#e2e8f0; }
    *{box-sizing:border-box; -webkit-tap-highlight-color:transparent}
    html{-webkit-text-size-adjust:100%}
    body{margin:0; background:var(--bg); color:var(--fg); font-family:Pretendard, system-ui, -apple-system, Segoe UI, Roboto, 'Noto Sans KR', Arial; transition:background .3s,color .3s}
    [data-theme="dark"] body{background:linear-gradient(180deg,#0a0f1f 0%, #0f1630 100%)}
    [data-theme="light"] body{background:linear-gradient(180deg,#f0f4f8 0%, #e6ecf2 100%)}
    .container{max-width:980px; margin:40px auto; padding:0 20px}
    .header{display:flex; align-items:center; gap:12px; margin-bottom:20px}
    .logo{width:42px;height:42px;border-radius:12px;background:var(--bg); display:flex;align-items:center;justify-content:center;border:1px solid var(--outline)}
    .brand{display:flex; flex-direction:column; gap:2px}
    h1{margin:0; font-size:26px; font-weight:700}
    .tagline{font-size:13px; color:var(--muted)}
    .card{background:var(--bg-card); border:1px solid var(--outline); border-radius:14px; padding:24px}
    .grid{display:grid; gap:16px}
    label.small{color:var(--muted); font-size:13px; font-weight:600}
    textarea{width:100%; min-height:200px; resize:vertical; background:var(--bg); color:var(--fg); border:1px solid var(--outline); border-radius:10px; padding:14px; font-size:14px; line-height:1.6}
    input, select{background:var(--bg); color:var(--fg); border:1px solid var(--outline); border-radius:10px; padding:10px; font-size:14px}
    .row2{display:grid; grid-template-columns:1fr auto auto; gap:10px; align-items:center}
    .switch{display:flex; gap:10px; align-items:center}
    button.primary{background:linear-gradient(135deg,#6aa6ff,#7b6cff); color:#fff; border:none; padding:14px 24px; border-radius:10px; font-weight:700; cursor:pointer; font-size:15px}
    button.primary:hover{filter:brightness(1.1); transform:translateY(-1px)}
    button.primary:disabled{opacity:.6; cursor:not-allowed; transform:none}
    .star-btn{background:var(--bg); border:1px solid var(--outline); padding:8px 12px; border-radius:8px; cursor:pointer; font-size:14px}
    [data-theme="dark"] .star-btn{color:#ffd966}
    [data-theme="light"] .star-btn{color:#d97706}
    .star-btn:hover{background:var(--bg-card); border-color:var(--brand)}
    .result{margin-top:18px; display:flex; align-items:center; gap:16px; flex-wrap:wrap}
    .badge{display:inline-flex; align-items:center; padding:6px 12px; border-radius:999px; font-size:12px; font-weight:700; text-transform:uppercase}
    .low{background:rgba(24,160,88,.15); color:#18a058}
    [data-theme="light"] .low{background:rgba(5,150,105,.15); color:#059669}
    .medium{background:rgba(194,155,0,.18); color:#ffd966}
    [data-theme="light"] .medium{background:rgba(217,119,6,.15); color:#d97706; font-weight:800}
    .high{background:rgba(199,31,31,.18); color:#ff9b9b}
    [data-theme="light"] .high{background:rgba(220,38,38,.15); color:#dc2626}
    .percent{font-size:32px; font-weight:700}
    .muted{color:var(--muted); font-size:13px}
    .spinner{display:inline-block; width:16px; height:16px; border:2px solid rgba(255,255,255,.3); border-top-color:#fff; border-radius:50%; animation:spin .8s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    .theme-toggle{position:fixed; top:20px; right:20px; background:var(--bg-card); border:1px solid var(--outline); padding:10px 16px; border-radius:8px; cursor:pointer; z-index:100; font-size:20px}
    .theme-toggle:hover{filter:brightness(1.1)}
    .settings{position:fixed; left:20px; bottom:20px; background:var(--bg-card); border:1px solid var(--outline); padding:12px; border-radius:10px; max-width:320px}
    .settings input{width:100%}
    @media (max-width:640px){ .container{margin:24px auto; padding:0 12px} h1{font-size:22px} .row2{grid-template-columns:1fr; gap:8px} .switch{flex-wrap:wrap} #apikey{min-width:0; width:100%} button.primary{width:100%} textarea{min-height:160px; font-size:15px} .theme-toggle{top:12px; right:12px} .settings{left:12px; right:12px; bottom:12px; max-width:none} }
  </style>
</head>
<body>
  <button class="theme-toggle" onclick="toggleTheme()" title="í…Œë§ˆ ì „í™˜">ğŸŒ™</button>
  <div class="container">
    <div class="header">
      <div class="logo">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200" width="42" height="42">
          <path d="M 70 100 Q 60 70, 80 50 Q 90 40, 95 60 Q 98 80, 85 95 Q 75 105, 70 100" fill="url(#orangeGrad)" stroke="#d97706" stroke-width="2"/>
          <path d="M 130 100 Q 140 70, 120 50 Q 110 40, 105 60 Q 102 80, 115 95 Q 125 105, 130 100" fill="url(#greenGrad)" stroke="#16a34a" stroke-width="2"/>
          <defs>
            <linearGradient id="orangeGrad" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" style="stop-color:#fb923c"/><stop offset="100%" style="stop-color:#ea580c"/></linearGradient>
            <linearGradient id="greenGrad" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" style="stop-color:#4ade80"/><stop offset="100%" style="stop-color:#16a34a"/></linearGradient>
          </defs>
        </svg>
      </div>
      <div class="brand">
        <h1>Verio</h1>
        <div class="tagline">AI ê¸°ë°˜ ëŒ€í™” ë¶„ì„ìœ¼ë¡œ ë¡œë§¨ìŠ¤ ìŠ¤ìº  ìœ„í—˜ íƒì§€</div>
      </div>
    </div>

    <div class="card grid">
      <label class="small" for=txt>ğŸ” SNSÂ·ë°ì´íŒ…ì•± ëŒ€í™” ë‚´ìš©ì„ ë¶™ì—¬ë„£ì–´ ë¶„ì„í•©ë‹ˆë‹¤</label>
      <textarea id=txt placeholder="ì˜ˆ) iTunes ê¸°í”„íŠ¸ì¹´ë“œë¡œ ë³´ë‚´ë‹¬ë¼ëŠ” ìš”ì²­ ë“± ì˜ì‹¬ ëŒ€í™”ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”."></textarea>
      <div class=row2>
        <div class=switch>
          <label><input type=checkbox id=mask checked> ê°œì¸ì •ë³´ ë§ˆìŠ¤í‚¹</label>
          <label><input type=checkbox id=auto-reanalyze checked> ìë™ ì¬ë¶„ì„</label>
          <select id=mode><option value="realtime" selected>ë¹ ë¥¸ ë¶„ì„</option><option value="detailed">ìƒì„¸ ë¶„ì„</option></select>
        </div>
        <input id=apikey type=password placeholder="ì œë¯¸ë‚˜ì´ í‚¤ (ì„ íƒ)" style="min-width:180px"/>
        <button id=btn class=primary>ë¶„ì„ ì‹œì‘</button>
      </div>
      <div class=result id=summary></div>
      <div id=evidence style="display:none; margin-top:16px"><h4 style="margin:0 0 10px 0; font-size:16px">ğŸ” ì¦ê±° ë¬¸ì¥</h4><div id=evidence-list style="display:grid; gap:8px"></div></div>
      <div id=reply-template style="display:none; margin-top:16px; padding:16px; background:rgba(24,160,88,.08); border:1px solid rgba(24,160,88,.2); border-radius:10px"><h4 style="margin:0 0 10px 0; font-size:16px; color:#73d49b">ğŸ’¬ ì•ˆì „í•œ ì‘ë‹µ ì˜ˆì‹œ</h4><div id=reply-text style="padding:12px; background:var(--bg); border:1px solid var(--outline); border-radius:8px; font-size:14px; color:var(--fg)"></div><button onclick="copyReply()" style="margin-top:10px; padding:8px 16px; background:var(--ok); border:none; color:white; border-radius:6px; cursor:pointer">ë³µì‚¬í•˜ê¸°</button></div>
      <div id=actions style="display:none; margin-top:16px; display:flex; gap:10px"><button onclick="shareResult()" style="padding:10px 16px; background:var(--brand); border:none; color:white; border-radius:8px; cursor:pointer">ê²°ê³¼ ê³µìœ </button><button onclick="downloadResult()" style="padding:10px 16px; background:var(--bg-card); border:1px solid var(--outline); color:var(--fg); border-radius:8px; cursor:pointer">ê²°ê³¼ ë‹¤ìš´ë¡œë“œ</button></div>
      <div id=feedback style="display:none; margin-top:16px; padding:16px; background:rgba(106,166,255,.08); border-radius:10px"><div style="margin-bottom:10px; font-weight:600">ì´ ë¶„ì„ ê²°ê³¼ê°€ ë„ì›€ì´ ë˜ì…¨ë‚˜ìš”?</div><div style="display:flex; gap:8px; margin-bottom:10px; flex-wrap:wrap"><button class="star-btn" data-rating="1">â­ ì „í˜€ ì•„ë‹˜</button><button class="star-btn" data-rating="2">â­â­ ë¶€ì¡±í•¨</button><button class="star-btn" data-rating="3">â­â­â­ ë³´í†µ</button><button class="star-btn" data-rating="4">â­â­â­â­ ì¢‹ìŒ</button><button class="star-btn" data-rating="5">â­â­â­â­â­ ë§¤ìš° ì¢‹ìŒ</button></div><textarea id="feedback-comment" placeholder="ì˜ê²¬ì„ ë‚¨ê²¨ì£¼ì„¸ìš” (ì„ íƒ)" style="width:100%; min-height:60px; margin-bottom:8px"></textarea><div style="font-size:12px; color:var(--muted)">ë‚®ì€ ë³„ì ì˜ ê²½ìš° ëŒ€í™” ë‚´ìš©ì´ ìµëª…ìœ¼ë¡œ ì €ì¥ë˜ì–´ ê°œì„ ì— í™œìš©ë©ë‹ˆë‹¤.</div></div>
    </div>
  </div>

  <div class="settings">
    <div style="font-weight:700; margin-bottom:6px; color:var(--brand)">API ì„œë²„ ì£¼ì†Œ</div>
    <input id="api-base" placeholder="ì˜ˆ: https://xxxx.ngrok-free.app ë˜ëŠ” CloudRun URL"/>
    <div style="display:flex; gap:8px; margin-top:8px"><button onclick="saveApiBase()" class="primary" style="padding:8px 12px">ì €ì¥</button><button onclick="clearApiBase()" style="padding:8px 12px; background:var(--bg-card); color:var(--fg); border:1px solid var(--outline); border-radius:10px">ì´ˆê¸°í™”</button></div>
    <div id="api-current" class="muted" style="margin-top:6px"></div>
  </div>

  <script>
    const API_BASE = (localStorage.getItem('api_base') || '').replace(/\/$/, '');
    function saveApiBase(){ const v = document.getElementById('api-base').value.trim().replace(/\/$/, ''); if(!v){alert('ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”');return;} localStorage.setItem('api_base', v); location.reload(); }
    function clearApiBase(){ localStorage.removeItem('api_base'); location.reload(); }
    function showApiBase(){ document.getElementById('api-base').value = API_BASE; document.getElementById('api-current').textContent = API_BASE ? ('í˜„ì¬: ' + API_BASE) : 'í˜„ì¬: (ì„¤ì • í•„ìš”)'; }

    const btn = document.getElementById('btn');
    const sum = document.getElementById('summary');
    const feedbackDiv = document.getElementById('feedback');
    let lastAnalysisResult=null, lastInputText=''; let reanalyzeTimer=null;

    document.getElementById('txt').addEventListener('input', () => {
      const text = document.getElementById('txt').value.trim(); const auto = document.getElementById('auto-reanalyze').checked;
      clearTimeout(reanalyzeTimer); btn.textContent='ë¶„ì„ ì‹œì‘'; btn.style.opacity='1';
      if (auto && text && lastInputText && text.includes(lastInputText) && text !== lastInputText) {
        btn.textContent='ì¶”ê°€ ê°ì§€...'; btn.style.opacity='0.8'; reanalyzeTimer=setTimeout(()=>{ btn.click(); btn.textContent='ë¶„ì„ ì‹œì‘'; btn.style.opacity='1'; },2000);
      }
    });

    btn.onclick = async () => {
      if (!API_BASE){ alert('ì¢Œì¸¡ í•˜ë‹¨ ì„¤ì •ì—ì„œ API ì„œë²„ ì£¼ì†Œë¥¼ ì €ì¥í•˜ì„¸ìš”.'); return; }
      const text = document.getElementById('txt').value.trim(); const mask = document.getElementById('mask').checked; const mode = document.getElementById('mode').value; if(!text){alert('ëŒ€í™” ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”'); return;}
      btn.disabled=true; btn.innerHTML='<span class="spinner"></span> ë¶„ì„ ì¤‘...'; lastInputText=text; sum.innerHTML=''; feedbackDiv.style.display='none';
      try{
        const headers={'Content-Type':'application/json'}; const k=document.getElementById('apikey').value.trim(); if(k) headers['X-Gemini-Key']=k;
        const r=await fetch(API_BASE+'/api/v1/analyze_text',{method:'POST',headers,body:JSON.stringify({text,mode,mask_pii:mask})});
        const data=await r.json(); lastAnalysisResult=data; const tier=(data.risk_tier||'unknown').toLowerCase(); const score=(data.score??0); const percent=Math.round(score*100);
        const cls=tier==='high'?'high':(tier==='medium'?'medium':'low'); const tierKo=tier==='high'?'ë†’ìŒ':(tier==='medium'?'ì¤‘ê°„':'ë‚®ìŒ'); const priorityKo={monitor:'ëª¨ë‹ˆí„°ë§',warn:'ê²½ê³ ',block:'ì°¨ë‹¨'}[data.recommended_action?.priority]||'-';
        sum.innerHTML=`<span class="badge ${cls}">${tierKo}</span><span class=percent>${percent}%</span><span class=muted>ê¶Œì¥ ì¡°ì¹˜: ${priorityKo}</span>`;
        const evidenceDiv=document.getElementById('evidence'); const evidenceList=document.getElementById('evidence-list');
        if(data.evidence_spans?.length){ evidenceList.innerHTML=data.evidence_spans.map(ev=>{ const flagKo=data.red_flags?.find(f=>f.type===ev.flag_type)?.type_ko||ev.flag_type; return `<div style="padding:10px; background:var(--bg); border-left:3px solid var(--${cls==='high'?'danger':(cls==='medium'?'warn':'brand')}); border-radius:6px; border:1px solid var(--outline)"><div style=\"font-size:12px; color:var(--muted); margin-bottom:4px\">í„´ ${ev.turn} (${ev.sender}) - ${flagKo}</div><div style=\"font-size:14px; color:var(--fg)\">${ev.text}</div></div>`; }).join(''); evidenceDiv.style.display='block'; } else { evidenceDiv.style.display='none'; }
        const replyDiv=document.getElementById('reply-template'); const replyText=document.getElementById('reply-text'); if(data.safe_reply_template){ replyText.textContent=data.safe_reply_template; replyDiv.style.display='block'; } else { replyDiv.style.display='none'; }
        document.getElementById('actions').style.display='flex'; feedbackDiv.style.display='block';
      }catch(e){ alert('ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. API ì£¼ì†Œ/ë„¤íŠ¸ì›Œí¬ë¥¼ í™•ì¸í•˜ì„¸ìš”.'); console.error(e); }
      finally{ btn.disabled=false; btn.textContent='ë¶„ì„ ì‹œì‘'; }
    };

    document.querySelectorAll('.star-btn').forEach(b=>{ b.onclick=async()=>{ if(!API_BASE){alert('API ì£¼ì†Œë¥¼ ì €ì¥í•˜ì„¸ìš”.');return;} if(!lastAnalysisResult)return; const rating=parseInt(b.dataset.rating); const comment=document.getElementById('feedback-comment').value.trim(); const payload={analysis_id:`analysis_${Date.now()}`,rating,actual_tier:null,comments:comment||null,conversation_text:lastInputText,predicted_tier:lastAnalysisResult.risk_tier,predicted_score:lastAnalysisResult.score}; try{ await fetch(API_BASE+'/api/v1/feedback',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)}); document.getElementById('feedback').innerHTML='<div style="color:#73d49b; font-weight:600">âœ… í”¼ë“œë°±ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤!</div>'; }catch(e){ alert('í”¼ë“œë°± ì „ì†¡ ì˜¤ë¥˜'); } }; });

    function copyReply(){ const t=document.getElementById('reply-text').textContent; navigator.clipboard.writeText(t).then(()=>alert('ì‘ë‹µ í…œí”Œë¦¿ì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.')); }
    function shareResult(){ const url=location.origin+location.pathname+'?shared='+Date.now(); navigator.clipboard.writeText(url).then(()=>alert('ê³µìœ  ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤: '+url)); }
    function downloadResult(){ if(!lastAnalysisResult) return; const d=lastAnalysisResult; const tierKo={low:'ë‚®ìŒ',medium:'ì¤‘ê°„',high:'ë†’ìŒ'}[d.risk_tier]||d.risk_tier; const percent=Math.round((d.score??0)*100); const priorityKo={monitor:'ëª¨ë‹ˆí„°ë§',warn:'ê²½ê³ ',block:'ì°¨ë‹¨'}[d.recommended_action?.priority]||'-'; const categoryKo={financial:'ê¸ˆì „',relationship:'ê´€ê³„',identity:'ì‹ ì›',behavioral:'í–‰ë™'}; const severityKo={severe:'ì‹¬ê°',moderate:'ë³´í†µ',mild:'ê²½ë¯¸'}; let report=`[Verio ë¡œë§¨ìŠ¤ ìŠ¤ìº  ë¶„ì„ ê²°ê³¼]\n\nìœ„í—˜ë„: ${tierKo}  |  ìŠ¤ìº  ê°€ëŠ¥ì„±: ${percent}%  |  ê¶Œì¥ ì¡°ì¹˜: ${priorityKo}\n\n`; (d.red_flags||[]).forEach((f,i)=>{const cat=categoryKo[f.category]||f.category; const sev=severityKo[f.severity]||f.severity; report+=`${i+1}. ${f.type_ko||f.description} (ë¶„ë¥˜:${cat}, ì‹¬ê°ë„:${sev})\n`;}); if(d.evidence_spans?.length){ report+=`\n[ì¦ê±° ë¬¸ì¥]\n`; d.evidence_spans.slice(0,5).forEach((ev,i)=>{ const name=d.red_flags?.find(f=>f.type===ev.flag_type)?.type_ko||ev.flag_type; report+=`${i+1}. [${name}] "${ev.text}" (í„´ ${ev.turn+1})\n`;}); } if(d.safe_reply_template){ report+=`\n[ì•ˆì „í•œ ì‘ë‹µ ì˜ˆì‹œ]\n"${d.safe_reply_template}"\n`; } const blob=new Blob([report],{type:'text/plain;charset=utf-8'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download=`Verio_ìŠ¤ìº ë¶„ì„_${new Date().toISOString().split('T')[0]}.txt`; a.click(); URL.revokeObjectURL(url); }
    function toggleTheme(){ const html=document.documentElement; const cur=html.getAttribute('data-theme'); const next=cur==='light'?'dark':'light'; html.setAttribute('data-theme',next); localStorage.setItem('theme',next); document.querySelector('.theme-toggle').textContent=next==='light'?'â˜€ï¸':'ğŸŒ™'; }
    window.addEventListener('DOMContentLoaded',()=>{ const savedTheme=localStorage.getItem('theme')||'dark'; document.documentElement.setAttribute('data-theme',savedTheme); document.querySelector('.theme-toggle').textContent=savedTheme==='light'?'â˜€ï¸':'ğŸŒ™'; showApiBase(); });
  </script>
</body>
</html>


